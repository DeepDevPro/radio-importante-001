<!DOCTYPE html>
<html lang="pt-BR">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>R√°dio Importante - Painel do Administrador</title>
	<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body class="body-admin-dash" data-bg="{{ imagem_fundo }}">

	<div class="box-admin-dash">

		<h1 class="admin-dash-title">Painel do Administrador</h1>
	
		<div class="admin-dash-tabs">
			<button class="tab active" data-aba="musicas">M√∫sicas</button>
			<button class="tab" data-aba="imagens">Imagens</button>
		</div>
	
		<main class="admin-dash-container">

			<!-- Aba de M√∫sicas -->
			<div class="aba aba-musicas active">

				<!-- Upload de M√∫sicas -->
				<section class="upload-box">
					<h2>Upload de M√∫sicas</h2>
					<div class="drop-area">
						<form id="form-upload-musicas" action="/upload-musicas" method="POST" enctype="multipart/form-data" class="upload-form">
							<input type="file" name="musicas" id="input-musicas" multiple accept="audio/mpeg, audio/wav, audio/x-aiff">
							
							<button type="submit" class="upload-button">Enviar M√∫sicas</button>
						</form>

						<div class="progress-container" style="display: none;">
							<div class="progress-bar" id="progress-bar"></div>
						</div>

						<div class="processing-overlay" style="display: none;">
							<div class="spinner"></div>
							<p>üéß Otimizando m√∫sicas, por favor aguarde...</p>
						</div>
						
						<p>Clique aqui para selecionar ou arraste arquivos de √°udio</p>
						<p><small>Arquivos de √°udio MP3, WAV, AIFF (m√°x. 300MB)</small></p>
					</div>
				</section>
		
				<!-- Lista de M√∫sicas -->
				<section class="list-box">
					<h2>M√∫sicas Dispon√≠veis</h2>

					<!-- Formul√°rio de exclus√£o em massa -->
					<form id="form-excluir-musicas" action="/excluir-musicas" method="POST">

						<div class="list-actions">
							<!-- <span>{{ total_musicas }} m√∫sicas</span> -->
							<span id="contador-selecionadas">Nenhuma m√∫sica selecionada</span>
							<button type="submit" class="delete-selected">Excluir Selecionados</button>
						</div>

						<div class="list-summary">
							<span>üéµ Total de m√∫sicas: {{ total_musicas }}</span>
							<span>‚è±Ô∏è Dura√ß√£o total: {{ duracao_total }}</span>
						</div>

						<table class="music-table">
							<thead>
								<tr>
									<th><input type="checkbox" id="check-todos"/></th>
									<th>#</th>
									<th>Artista</th>
									<th>M√∫sica</th>
									<th>Vers√£o</th>
									<th>Dura√ß√£o</th>
									<th id="c4">A√ß√µes</th>
								</tr>
							</thead>
							<tbody>
								{% for musica in musicas %}
								<tr>
									<td><input type="checkbox" name="ids" value="{{ musica.id }}" class="check-musica"/></td>
									<td>{{ loop.index }}</td>
									<td>{{ musica.artista.replace("_", " ") }}</td>
									<td>{{ musica.titulo.replace("_", " ") }}</td>
									<!-- <td>{{ musica.versao or "-" }}</td> -->
									<td>{{ musica.versao.replace("_", " ") if musica.versao else "-" }}</td>
									<td>
										{% set dur = musica.duracao_segundos %}
										{{ "%02d:%02d:%02d" | format(dur // 3600, (dur % 3600) // 60, dur % 60) }}
									</td>
									<td id="c4">
										<form action="/excluir-musicas" method="POST" onsubmit="return confirm('Deseja excluir esta m√∫sca?')">
											<input type="hidden" name="ids" value="{{ musica.id }}">
											<button class="delete-btn" type="submit">Excluir</button>
										</form>
									</td>
								</tr>
								{% endfor %}
							</tbody>
						</table>
					</form> 
				</section>
			</div>

			<!--  ‚úÖ Aba de Imagens (a ser preenchida na aula 4)  -->
			<div class="aba aba-imagens">
				
				<!-- Upload de Imagens -->
				<section class="upload-box">
					<h2>Upload de Imagens</h2>
					
					<div class="drop-area">
						<form id="form-upload-imagem" action="/upload-imagens" method="POST" enctype="multipart/form-data" class="upload-form">
							<h2>Upload de Imagens</h2>

							<input type="file" name="imagens" id="input-imagem" multiple accept="image/png, image/jpeg">

							<button type="submit" class="upload-button">Enviar Imagens</button>
						</form>

						<p>Clique aqui para selecionar ou arraste arquivos de imagem</p>

						<p><small>Imagens JPG, PNG (m√°x. 25mb)</small></p>
					</div>

					<button class="upload-button">Enviar Imagens</button>
				</section>

				<!-- Galeria de Imagens -->
				<section class="gallery-box">
					<h2>Galeria de Imagens</h2>
					<div class="image-gallery">
						{% for imagem in galeria_imagens %}
						{% set imagem_original = imagem.nome | replace('thumb_', '') %}
						<div class="image-card {% if imagem_original == imagem_fundo %}active{% endif %}">
							<!-- <img src="{{ url_for('static', filename='img/galeria/' ~ imagem) }}" alt="Imagem galeria"> -->
							<img src="{{ imagem.url }}" data-nome="{{ imagem.nome }}">
						
						<form action="/definir-fundo" method="POST">
							<input type="hidden" name="imagem" value="{{ imagem_original }}">
							<button class="set-bg-btn" type="submit">Usar como fundo</button>
						</form>
						</div>
						{% endfor %}
					</div>
				</section>
			</div>
	
		</main>
	</div>

	<script src="{{ url_for('static', filename='js/admin-dashboard.js') }}"></script>
	<script src="{{ url_for('static', filename='js/set-background.js') }}"></script>
	
	<!-- DEBUG: imagem_fundo={{ imagem_fundo }}, outras={{ outras_variaveis }} -->
	 
</body>
</html>